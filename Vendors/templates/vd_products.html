{% extends 'vd_base.html' %}

{% block content %}
{% load custom_filter %}
<div class="container-fluid mt-3">
	<div class="row">

		<!-- filter -->

		<div class="col-lg-3 mx-auto">
			<div class="list-group">

				<a href="/vendors/my_products" class="list-group-item list-group-item-action btn
					btn-outline-success">All Products</a>

				{% for category in categories %}
				<a href="/vendors/my_products?category={{category.id}}"
					class="list-group-item list-group-item-action btn btn-outline-success ">{{category.name}}</a>
				{% endfor %}
			</div>
		</div>

		
		<!-- all products -->
		<div id='products' class="col-lg-9 mx-auto">
			<br>
			<div id="content">
				<h2>Management System - Products</h2>
			</div>

			<br>
			<div class="results">
				<table class="table table-bordered">
					<thead>
						<tr>						
							<th scope="col" class="action-checkbox-column">
							<div class="text"></div>
							<div class="clear"></div>
							</th>

							<th scope="col" class="sortable column-name" width="12%">
								<div class="text" style="text-align: center;">Image</div>
								<div class="clear"></div>
							</th>

							<th scope="col" class="sortable column-name">
							<div class="text" >Name</div>
							<div class="clear"></div>
							</th>

							<th scope="col" class="sortable column-price">
							<div class="text">Price</div>
							<div class="clear"></div>
							</th>

							<th scope="col" class="sortable column-category sorted ascending">
							<div class="text">Category</div>
							<div class="clear"></div>
							</th>

							<th scope="col" class="sortable column-name">
								<div class="text" >Status</div>
								<div class="clear"></div>
							</th>

							<th width="10%"> </th>

						</tr>
					</thead>
					
					<tbody>
						{% for product in products %}
						<tr>
							<td>
								{{ forloop.counter }}
							</td>
							

							<td id={{product.id}} class="text-center">
								<img class="avatar" src="{{product.image.url}}" style="vertical-align: middle;
								width: 65px;
								height: 62px;
								border-radius: 50%;
								border: 2px solid #e0d1c6">
							</td>

							<th class="field-name">
								<a href="my_products/{{product.id}}">
									{{product.name}}
								</a>
							</th>

							<td class="field-price">
								<a> {{product.price|currency}} </a>
							</td>

							<td class="field-category nowrap">
								<a>{{product.category}}</a>
        					</td>

							<td class="field-category nowrap">
								{% if product.status %}
								<small class="badge badge-success" style="font-size: 13px; padding: 8px;">Ready to Sell</small>
								{%else%}
								<small class="badge badge-danger" style="font-size: 13px; padding: 8px;">Not Available</small>
								{% endif %}
        					</td>

							<td class="field-price" >
								<div class="text-center">
									<class="nav-link" href="/test">
										<button style=" border-radius: 7px; border: 1px solid lightgray; flex:0.5;">
											<img src = 'https://upload.wikimedia.org/wikipedia/commons/thumb/9/9a/OOjs_UI_icon_edit-ltr-gray.svg/120px-OOjs_UI_icon_edit-ltr-gray.svg.png?20211119134628' 
											style="width: 20px; height: 20px; margin-bottom: 4px;">
										</button>
	
									<button style="border-radius: 7px; border: 1px solid lightgray; flex: 0.5;" onclick="confirmDelete({{ product.id }})">
										<img src = 'https://www.shareicon.net/data/128x128/2015/09/06/96798_trash_512x512.png' style="width: 20px; height: 20px; margin-bottom: 4px;">
									</button>
								
									<script>
										function confirmDelete(productId) {
											var popup = document.createElement('div');
											popup.setAttribute('class', 'popup');
											popup.setAttribute('id', 'popup');
											popup.innerHTML = `
												<p style="font-size: 20px; margin: 30px 0 10px;">Are you sure you want to delete this product?</p>
												<button type="button" onclick="deleteProduct(${productId})"
													style="width: 100px; margin-right: 10px; padding: 10px; background: rgb(82, 201, 82);
													color: white; border: 0;border-radius: 4px; font-size: 18 px; cursor: pointer; box-shadow: 0 2px rgba(0,0,0,0.2); outline: none;">
													OK
												</button>
												<button type="button" onclick="closePopup()"
													style="width: 100px; margin-left: 10px; padding: 10px; background: rgb(255, 0, 0);
													color: white; border: 0;border-radius: 4px; font-size: 18 px; cursor: pointer; box-shadow: 0 2px rgba(0,0,0,0.2); outline: none;">
													Cancel
												</button>
											`;
											document.body.appendChild(popup);
										}
									
										function deleteProduct(productId) {
											var popup = document.getElementById('popup');
											popup.innerHTML = `<p style="font-size: 20px; margin: 30px 0 10px;">Deleting...</p>`;
											fetch('/delete_product/' + productId, {
												method: 'DELETE',
											})
											.then(response => {
												if (response.ok) {
													popup.innerHTML = `
														<p style="font-size: 20px; margin: 30px 0 10px;">Delete successful!</p>
														<button type="button" onclick="closePopup()"
															style="width: 100%; margin-top: 50px; padding: 10px; background: rgb(82, 201, 82);
															color: white; border: 0;border-radius: 4px; font-size: 18px; cursor: pointer; box-shadow: 0 2px rgba(0,0,0,0.2); outline: none;">
															Back
														</button>
													`;
													
												} else {
													popup.innerHTML = `
														<p style="font-size: 20px; margin: 30px 0 10px;"> Delete failed.</p>
														<button type="button" onclick="closePopup()"
															style="width: 100%; margin-top: 50px; padding: 10px; background: rgb(255, 0, 0);
															color: white; border: 0;border-radius: 4px; font-size: 18px; cursor: pointer; box-shadow: 0 2px rgba(0,0,0,0.2); outline: none;">
															Back
														</button>
													`;
												}
											})
										}
									
										function closePopup() {
											var popup = document.getElementById('popup');
											if (popup) {
												popup.parentNode.removeChild(popup);
											}
										}
									</script>
									
									
									
								<!-- <div class="popup" id="popup"
                                    style="width: 500px; background: #fff; border-radius: 6px; position: absolute; top: 35% ; left: 20%;
                                    text-align: center; padding: 0 30px 30px; transform: (-50%, -50%); border: 1px solid gray;">
                                    <p style="font-size: 20px; margin: 30px 0 10px;"> {{delete_successful}}</p>
                                    <button type="button" onclick="closePopup()"
                                    style="width: 100%; margin-top: 50px; padding: 10px; background: rgb(82, 201, 82); 
                                    color: white; border: 0;border-radius: 4px; font-size: 18 px; cursor: pointer; box-shadow: 0 2px rgba(0,0,0,0.2); outline: none;"> Back </button>
                                </div> -->
								

								</div>
							</td>

						</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
			

		</div>
	</div>
</div>


{% endblock %}